instance_name=${1:-magento1}

cd /home/cloudpanel/htdocs/
rm ${instance_name}.mgt -rf
composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition ${instance_name}.mgt
cd ${instance_name}.mgt
bin/magento setup:install \
    --backend-frontname='admin' --key='18Av6ITivOZG3gwY1DhMDWtlLfx1spLP' \
    --session-save='files' --db-host='127.0.0.1' --db-name="${instance_name}" \
    --db-user="${instance_name}" --db-password="dbpass" \
    --base-url="http://${instance_name}.mgt/" --base-url-secure="https://${instance_name}.mgt/" \
    --admin-user='admin' --admin-password='admin123' \
    --admin-email='john@doe.com' --admin-firstname='John' --admin-lastname='Doe'
chmod -R 777 .
bin/magento module:disable Magento_AdminAdobeImsTwoFactorAuth Magento_TwoFactorAuth
composer require incomaker/magento2
bin/magento setup:upgrade
bin/magento setup:di:compile
bin/magento cache:clean
bin/magento cache:flush
chmod -R 777 .
bin/magento deploy:mode:set developer
